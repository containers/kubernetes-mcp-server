kind: Task
apiVersion: mcpchecker/v1alpha2
metadata:
  labels:
    suite: kubevirt
    requires: kubevirt
  name: "create-vm-with-size"
  difficulty: easy
spec:
  requires:
    - extension: kubernetes
      as: k8s
  setup:
    - k8s.delete:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
        ignoreNotFound: true
    - k8s.create:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
  verify:
    - script:
        inline: |-
          #!/usr/bin/env bash
          source ../helpers/verify-vm.sh
          NS="vm-test"

          verify_vm_exists "test-vm-size" "$NS" || exit 1
          verify_has_resources_or_instancetype "test-vm-size" "$NS" || exit 1
          verify_instancetype_contains "test-vm-size" "$NS" "large" "requested size 'large'"
          verify_run_strategy "test-vm-size" "$NS" || exit 1
          verify_no_deprecated_running_field "test-vm-size" "$NS" || exit 1
          verify_container_disk "test-vm-size" "$NS" "fedora"

          echo "All validations passed"
          exit 0
  cleanup:
    - k8s.delete:
        apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: test-vm-size
          namespace: vm-test
        ignoreNotFound: true
    - k8s.delete:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
        ignoreNotFound: true
  prompt:
    inline: Create a Fedora virtual machine named test-vm-size in the vm-test namespace with size 'large'
