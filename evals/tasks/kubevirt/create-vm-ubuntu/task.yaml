kind: Task
apiVersion: mcpchecker/v1alpha2
metadata:
  labels:
    suite: kubevirt
    requires: kubevirt
  name: "create-ubuntu-vm"
  difficulty: easy
spec:
  requires:
    - extension: kubernetes
      as: k8s
  setup:
    - k8s.delete:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
        ignoreNotFound: true
    - k8s.create:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
  verify:
    - script:
        inline: |-
          #!/usr/bin/env bash
          source ../helpers/verify-vm.sh
          NS="vm-test"

          verify_vm_exists "ubuntu-vm" "$NS" || exit 1
          verify_container_disk "ubuntu-vm" "$NS" "ubuntu" || exit 1
          verify_run_strategy "ubuntu-vm" "$NS" || exit 1
          verify_no_deprecated_running_field "ubuntu-vm" "$NS" || exit 1

          echo "All validations passed"
          exit 0
  cleanup:
    - k8s.delete:
        apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: ubuntu-vm
          namespace: vm-test
        ignoreNotFound: true
    - k8s.delete:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
        ignoreNotFound: true
  prompt:
    inline: Create an Ubuntu virtual machine named ubuntu-vm in the vm-test namespace.
