kind: Task
apiVersion: mcpchecker/v1alpha2
metadata:
  name: "pause-vm"
  difficulty: medium
spec:
  requires:
    - extension: kubernetes
      as: k8s
  setup:
    - k8s.delete:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
        ignoreNotFound: true
    - k8s.create:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
    - k8s.create:
        apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: paused-vm
          namespace: vm-test
        spec:
          runStrategy: Always
          template:
            spec:
              domain:
                devices:
                  disks:
                    - name: containerdisk
                      disk:
                        bus: virtio
                resources:
                  requests:
                    memory: 2Gi
              terminationGracePeriodSeconds: 0
              volumes:
                - name: containerdisk
                  containerDisk:
                    image: quay.io/containerdisks/opensuse-leap:15.6
    - k8s.wait:
        apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: paused-vm
          namespace: vm-test
        condition: Ready
        timeout: 30s
  verify:
    - k8s.wait:
        apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: paused-vm
          namespace: vm-test
        condition: Paused
        timeout: 5s
  cleanup:
    - k8s.delete:
        apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: paused-vm
          namespace: vm-test
        ignoreNotFound: true
    - k8s.delete:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: vm-test
        ignoreNotFound: true
  prompt:
    inline: |
      Please pause the virtual machine named paused-vm in the vm-test namespace.
